@model IEnumerable<InventoryManagement.Models.Assignment>

@{
    ViewData["Title"] = "Assignments";
}



<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 >Assignments</h2>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addAssignmentModal">
        <i class="bi bi-link-45deg"></i> Add Assignment
    </button>
</div>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}
@if (TempData["Message"] != null)
{
    <div class="alert alert-success">@TempData["Message"]</div>
}



@section Scripts {
    <script>
        $(document).ready(function () {
            function filterTable() {
                var empName = $('#searchEmployee').val().toLowerCase();
                var invType = $('#searchType').val().toLowerCase();
                var invBrand = $('#searchBrand').val().toLowerCase();
                var status = $('#searchStatus').val().toLowerCase();

                $('table tbody tr').each(function () {
                    var row = $(this);
                    var rowEmp = row.find('td:eq(1)').text().toLowerCase();   
                    var rowType = row.find('td:eq(3)').text().toLowerCase(); 
                    var rowBrand = row.find('td:eq(4)').text().toLowerCase();
                    var rowStatus = row.find('td:eq(7)').text().toLowerCase();

                    if ((rowEmp.includes(empName) || !empName) &&
                        (rowType.includes(invType) || !invType) &&
                        (rowBrand.includes(invBrand) || !invBrand) &&
                        (rowStatus.includes(status) || !status)) {
                        row.show();
                    } else {
                        row.hide();
                    }
                });
            }

            $('#searchEmployee, #searchType, #searchBrand, #searchStatus').on('keyup change', filterTable);

            $('#clearFilters').on('click', function () {
                $('#searchEmployee, #searchType, #searchBrand, #searchStatus').val('');
                filterTable();
            });
        });
    </script>
}

<!-- 🔍 Search Filters -->
<div class="card shadow-sm mb-4">
    <div class="card-header bg-light fw-bold">
        <i class="bi bi-funnel"></i> Filter Assignments
    </div>
    <div class="card-body">
        <div class="row g-2">
            <div class="col-md-3">
                <input type="text" id="searchEmployee" class="form-control" placeholder="Search by Employee Name" />
            </div>
            <div class="col-md-3">
                <input type="text" id="searchType" class="form-control" placeholder="Search by Inventory Type" />
            </div>
            <div class="col-md-3">
                <input type="text" id="searchBrand" class="form-control" placeholder="Search by Brand" />
            </div>
            <div class="col-md-3">
                <select id="searchStatus" class="form-select">
                    <option value="">All Status</option>
                    <option value="assigned">Assigned</option>
                    <option value="completed">Completed</option>
                </select>
            </div>
        </div>
        <div class="mt-3 text-end">
            <button class="btn btn-secondary" id="clearFilters">
                <i class="bi bi-x-circle"></i> Clear Filters
            </button>
        </div>
    </div>
</div>

<!-- Assignment Table -->
<div class="card shadow-sm">
    <div class="card-body p-0">
        <table class="table table-hover table-bordered mb-0">
<thead class="table-primary">
    <tr>
        <th>ID</th>
        <th>Employee</th>
        <th>Inventory</th>
        <th>Type</th>
        <th>Brand</th>
        <th>Assigned On</th>
        <th>Unassigned On</th>
        <th>Status / Action</th>
    </tr>
</thead>
<tbody>
    @foreach (var item in Model)
    {
        <tr>
            <td>@item.AssignmentID</td>
            <td>@item.EmployeeName (ID - @item.EmployeeID)</td> 
            <td>@item.InventoryId</td>
            <td>@item.InventoryType</td>
            <td>@item.Brand</td>
            <td>@item.AssignedOn.ToString("yyyy-MM-dd")</td>
            <td>@(item.UnassignedOn.HasValue? item.UnassignedOn.Value.ToString("yyyy-MM-dd") : "-")</td>
            <td>
                @if (!item.UnassignedOn.HasValue)
                {
                    <form asp-action="Unassign" asp-controller="Assignment" method="post" class="d-inline">
                        @Html.AntiForgeryToken()
                        <input type="hidden" name="assignmentId" value="@item.AssignmentID" />
                        <button type="submit" class="btn btn-sm btn-warning">
                            <i class="bi bi-box-arrow-right"></i> Unassign
                        </button>
                    </form>
                    <span class="badge bg-success ms-2">Assigned</span>
                }
                else
                {
                    <span class="badge bg-secondary">Completed</span>
                }
            </td>
        </tr>
    }
</tbody>
        </table>
    </div>
</div>


<!-- Add Assignment Modal -->

<div class="modal fade" id="addAssignmentModal" tabindex="-1" aria-labelledby="addAssignmentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form asp-action="Add" asp-controller="Assignment" method="post">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="addAssignmentModalLabel">Add Assignment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Select Employee</label>
                        <select name="EmployeeID" class="form-select" required>
                            <option value="">-- Choose Employee --</option>
                            @foreach (var emp in ViewBag.Employees as List<SelectListItem>)
                            {
                                <option value="@emp.Value">@emp.Text</option>
                            }
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Select Inventory</label>
                        <select name="InventoryId" class="form-select" required>
                            <option value="">-- Choose Inventory --</option>
                            @foreach (var inv in ViewBag.Inventories as List<SelectListItem>)
                            {
                                <option value="@inv.Value">@inv.Text</option>
                            }
                        </select>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i> Assign
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
